<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./css/public.css">
    <link rel="stylesheet" href="./css/index.css">
    <title>Document</title>
</head>

<body>
    <div class="app">
        <div class="container">
            <div class="cart">
                <div class="header">
                    <div class="left">
                        <h2>购物车</h2>
                    </div>
                    <div class="right">
                        <span class="explain">
                            已选商品（不含运费）
                        </span>
                        <span style="font-size: 12px;color: #FF5000;">￥</span>
                        <span class="price">
                            0.00
                        </span>
                        <span class="submit">
                            结算
                        </span>
                    </div>
                </div>
                <div class="cart-list">
                    <ul class="title">
                        <li class="item" style="margin-left: 15px;">
                            <div class="all">
                                <input id="allselect" type="checkbox" value="全选">
                                <label for="allselect">全选</label>
                            </div>
                        </li>
                        <li class="item">商品信息</li>
                        <li></li>
                        <li></li>
                        <li class="item" style="margin-right: 36px;">单价</li>
                        <li class="item">数量</li>
                        <li class="item">操作</li>
                    </ul>
                    <ul class="goods">
                        <li class="good-item">
                            <div class="all">
                                <input id="allselect" type="checkbox" value="眼镜">
                            </div>
                            <div class="img">
                                <img src="https://img.alicdn.com/bao/uploaded/i3/2904347719/O1CN01s9fRP326tLwbfiRdT_!!2904347719.png_80x80.jpg"
                                    alt="">
                            </div>
                            <div class="title">
                                暴龙新款光学镜框时尚大脸男女金属眼镜架BJ7052王俊凯同款BJ7192
                            </div>
                            <div class="rice">
                                <span class="money">438.00</span>
                            </div>
                            <div class="count">
                                <p class="reduce">-</p>
                                <input type="number" name="" id="" value="1">
                                <p class="add">+</p>
                            </div>
                            <div class="desc">
                                删除
                            </div>
                        </li>
                        <li class="good-item">
                            <div class="all">
                                <input id="allselect" type="checkbox" value="手表">
                            </div>
                            <div class="img">
                                <img src="https://img.alicdn.com/bao/uploaded/i1/1917047079/O1CN01yqdFtA22AESMw7sLr_!!2-item_pic.png_80x80.jpg"
                                    alt="">
                            </div>
                            <div class="title">
                                Apple/苹果 Apple Watch SE；金色铝金属表壳；星光色运动型表带
                            </div>
                            <div class="rice">
                                <span class="money">2499.00</span>
                            </div>
                            <div class="count">
                                <p class="reduce">-</p>
                                <input type="number" name="" id="" value="1">
                                <p class="add">+</p>
                            </div>
                            <div class="desc">
                                删除
                            </div>
                        </li>
                        <li class="good-item">
                            <div class="all">
                                <input id="allselect" type="checkbox" value="手机">
                            </div>
                            <div class="img">
                                <img src="https://img.alicdn.com/bao/uploaded/i4/1917047079/O1CN01UOAs3S22AEUVxCTbE_!!1917047079.png_80x80.jpg"
                                    alt="">
                            </div>
                            <div class="title">
                                Apple/苹果 iPhone 13
                            </div>
                            <div class="rice">
                                <span class="money">5999.00</span>
                            </div>
                            <div class="count">
                                <p class="reduce">-</p>
                                <input type="number" name="" id="" value="1">
                                <p class="add">+</p>
                            </div>
                            <div class="desc">
                                删除
                            </div>
                        </li>
                        <li class="good-item">
                            <div class="all">
                                <input id="allselect" type="checkbox" value="相机">
                            </div>
                            <div class="img">
                                <img src="	https://img.alicdn.com/bao/uploaded/i2/2874484355/O1CN01TEfrFE1i2dbqw2OPm_!!2874484355.jpg_80x80.jpg"
                                    alt="">
                            </div>
                            <div class="title">
                                Leica/徕卡 D-LUX7多功能便携数码相机 卡片相机 微单相机 4K录制
                            </div>
                            <div class="rice">
                                <span class="money">10800.00</span>
                            </div>
                            <div class="count">
                                <p class="reduce">-</p>
                                <input type="number" name="" id="" value="1">
                                <p class="add">+</p>
                            </div>
                            <div class="desc">
                                删除
                            </div>
                        </li>
                        <li class="good-item">
                            <div class="all">
                                <input id="allselect" type="checkbox" value="相机">
                            </div>
                            <div class="img">
                                <img src="	https://img.alicdn.com/bao/uploaded/i2/640332672/O1CN01BsxuOj1Vbp2TFVrE4_!!640332672.jpg_80x80.jpg"
                                    alt="">
                            </div>
                            <div class="title">
                                ADAMF国潮重磅260克纯棉短袖T恤男女生宽松体恤潮流INS情侣半袖
                            </div>
                            <div class="rice">
                                <span class="money">59.00</span>
                            </div>
                            <div class="count">
                                <p class="reduce">-</p>
                                <input type="number" name="" id="" value="1">
                                <p class="add">+</p>
                            </div>
                            <div class="desc">
                                删除
                            </div>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
    <script>
        var selectAll = document.querySelector('#allselect')
        var selectItems = document.querySelectorAll('.goods .all input')
        var add = document.querySelectorAll('.add')
        var count = document.querySelectorAll('.count')
        var zero = document.querySelectorAll('.count input')
        var price = document.querySelector('.price')
        var goods = document.querySelectorAll('.goods li')
        var del = document.querySelectorAll('.desc')
        var submit = document.querySelector('.submit')
        var body = document.querySelector('body')
        var cc = 0
        //数量的加减
        count.forEach((val) => {
            val.onclick = (e) => {
                if (e.target.className == 'add') {
                    val.children[1].value = Number(val.children[1].value) + 1
                    console.log(val.parentNode.firstElementChild.firstElementChild.checked)
                    //动态改变加
                    if (val.parentNode.firstElementChild.firstElementChild.checked) {
                        var prices = document.querySelector('.price')
                        var p = Number(prices.innerHTML)
                        var dan = Number(val.parentNode.children[3].firstElementChild.innerHTML)
                        p = p + dan
                        prices.innerHTML = p.toFixed(2)
                    }
                }
                if (e.target.className == 'reduce') {
                    console.log(val.children[1].value)
                    val.children[1].value = Number(val.children[1].value) - 1
                    //动态改变加
                    if (val.parentNode.firstElementChild.firstElementChild.checked && val.children[1].value >= 1) {
                        var prices = document.querySelector('.price')
                        var p = Number(prices.innerHTML)
                        var dan = Number(val.parentNode.children[3].firstElementChild.innerHTML)
                        p = p - dan
                        prices.innerHTML = p.toFixed(2)
                    }
                }
                if (Number(val.children[1].value) < 1) {
                    val.children[1].value = 1
                }
            }
        })
        zero.forEach((val, index) => {
            val.onchange = () => {
                if (val.value < 1) {
                    val.value = 1
                }
                console.log(val.parentNode.parentNode.children[0].firstElementChild.checked)
                if (val.parentNode.parentNode.children[0].firstElementChild.checked) {
                    console.log(Number(val.parentNode.parentNode.children[3].firstElementChild.innerHTML))
                    console.log(zero[index].value - a)
                }
            }
        })


        //全选 全不选
        selectAll.onchange = () => {
            var type = selectAll.checked
            for (let i = 0; i < selectItems.length; i++) {
                selectItems[i].checked = type
            }
            var toall = 0
            if (selectAll.checked) {
                for (let i = 0; i < goods.length; i++) {
                    var coun = parseFloat(goods[i].children[4].children[1].value)
                    var pri = parseFloat(goods[i].children[3].firstElementChild.innerHTML)
                    toall += coun * pri
                }
                price.innerHTML = toall.toFixed(2)
            }

            if (!selectAll.checked) {
                console.log(toall)
                price.innerHTML = toall.toFixed(2)
                console.log(price.innerHTML)
            }
        }
        
        for (let i = 0; i < selectItems.length; i++) {
            selectItems[i].onchange = (e) => {
                var temp = true
                for (let j = 0; j < selectItems.length; j++) {
                    if (selectItems[j].checked == false) {
                        temp = false
                    }
                }
                selectAll.checked = temp
                if (selectItems[i].checked) {
                    var monovalent = Number(e.target.parentNode.nextElementSibling.nextElementSibling.nextElementSibling.firstElementChild.innerHTML)
                    var amount = Number(e.target.parentNode.nextElementSibling.nextElementSibling.nextElementSibling.nextElementSibling.children[1].value)
                    var allMoney = monovalent * amount
                    cc += allMoney
                    price.innerHTML = cc.toFixed(2)
                }
                var pr =parseFloat(price.innerHTML) 
                console.log(pr)
                if(!selectAll.checked){
                    pr = 0
                }
                if(!selectAll.checked&&selectItems[0].checked||selectItems[1].checked||selectItems[2].checked||selectItems[3].checked||selectItems[4].checked){
                    pr = parseFloat(price.innerHTML) 
                }
                if (!selectItems[i].checked) {
                    cc = pr
                    var monovalent = Number(e.target.parentNode.nextElementSibling.nextElementSibling.nextElementSibling.firstElementChild.innerHTML)
                    var amount = Number(e.target.parentNode.nextElementSibling.nextElementSibling.nextElementSibling.nextElementSibling.children[1].value)
                    var allMoney = monovalent * amount
                    cc -= allMoney
                    price.innerHTML = cc.toFixed(2)
                }
                if (cc < 0) {
                    cc = 0
                    price.innerHTML = cc.toFixed(2)
                }
            }

        }


        //删除操作
        del.forEach((val) => {
            val.onclick = (e) => {
                val.parentNode.remove()
                if (val.parentNode.firstElementChild.firstElementChild.checked) {
                    var p = document.querySelector('.price')
                    p = Number(p.innerHTML).toFixed(2)
                    var coun = parseFloat(val.parentNode.children[4].children[1].value).toFixed(2)
                    var mon = parseFloat(val.parentNode.children[3].firstElementChild.innerHTML).toFixed(2)
                    p = p - coun * mon
                    price.innerHTML = p.toFixed(2)
                }
            }
        })

        //结算
        submit.onclick = () => {
            var money = Number(price.innerHTML)
            if (money > 0) {
                alert('购买成功！！')
                location.reload()
            } else {
                alert('请先选择您要购买的物品')
            }

        }

    </script>
</body>

</html>